{"ast":null,"code":"// ============================================================\n// BRD-Compliant Chat API Service\n// Implements all BRD endpoints: /initiate, /message, /quick-action\n// ============================================================\n\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\nexport class ChatService {\n  /**\r\n   * BRD ยง5.1, Epic 1: Initialize chatbot after booking confirmation\r\n   * Endpoint: POST /api/chatbot/initiate\r\n   */\n  async initiateChatbot(bookingId, userId, driverId) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/chatbot/initiate`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          bookingId,\n          userId,\n          driverId\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Initiate API Error: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('ChatService.initiateChatbot Error:', error);\n      throw error;\n    }\n  }\n\n  /**\r\n   * BRD Epic 4: Send free-text message\r\n   * Endpoint: POST /api/chatbot/message\r\n   */\n  async sendMessage(conversationId, bookingId, userId, message) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/chatbot/message`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          conversationId,\n          bookingId,\n          userId,\n          message\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Message API Error: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('ChatService.sendMessage Error:', error);\n      throw error;\n    }\n  }\n\n  /**\r\n   * BRD Epic 3: Quick action button tap\r\n   * Endpoint: POST /api/chatbot/quick-action\r\n   */\n  async sendQuickAction(conversationId, bookingId, userId, action) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/chatbot/quick-action`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          conversationId,\n          bookingId,\n          userId,\n          action\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Quick Action API Error: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('ChatService.sendQuickAction Error:', error);\n      throw error;\n    }\n  }\n\n  /**\r\n   * BRD Epic 5: Escalate to driver/support\r\n   * Endpoint: POST /api/chatbot/escalate\r\n   */\n  async escalate(request) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/chatbot/escalate`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(request)\n      });\n      if (!response.ok) {\n        throw new Error(`Escalation API Error: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('ChatService.escalate Error:', error);\n      throw error;\n    }\n  }\n\n  /**\r\n   * Close conversation\r\n   * Endpoint: POST /api/chatbot/close\r\n   */\n  async closeConversation(conversationId, reason) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/chatbot/close`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          conversationId,\n          reason\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Close API Error: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('ChatService.closeConversation Error:', error);\n      throw error;\n    }\n  }\n}\nexport default new ChatService();","map":{"version":3,"names":["API_BASE_URL","process","env","REACT_APP_API_URL","ChatService","initiateChatbot","bookingId","userId","driverId","response","fetch","method","headers","body","JSON","stringify","ok","Error","status","json","error","console","sendMessage","conversationId","message","sendQuickAction","action","escalate","request","closeConversation","reason"],"sources":["C:/Users/ASUS-PC/Desktop/Projects/RideShare--Chatbot/frontend/src/features/chat/chat_service/api.ts"],"sourcesContent":["// ============================================================\r\n// BRD-Compliant Chat API Service\r\n// Implements all BRD endpoints: /initiate, /message, /quick-action\r\n// ============================================================\r\n\r\nimport { ChatRequest, ChatResponse, InitResponse, EscalationRequest } from '../chat_model/types';\r\n\r\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\r\n\r\nexport class ChatService {\r\n    /**\r\n     * BRD ยง5.1, Epic 1: Initialize chatbot after booking confirmation\r\n     * Endpoint: POST /api/chatbot/initiate\r\n     */\r\n    async initiateChatbot(bookingId: string, userId: string, driverId?: string): Promise<InitResponse> {\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/api/chatbot/initiate`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ bookingId, userId, driverId }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`Initiate API Error: ${response.status}`);\r\n            }\r\n\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('ChatService.initiateChatbot Error:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * BRD Epic 4: Send free-text message\r\n     * Endpoint: POST /api/chatbot/message\r\n     */\r\n    async sendMessage(\r\n        conversationId: string,\r\n        bookingId: string,\r\n        userId: string,\r\n        message: string\r\n    ): Promise<ChatResponse> {\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/api/chatbot/message`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ conversationId, bookingId, userId, message }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`Message API Error: ${response.status}`);\r\n            }\r\n\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('ChatService.sendMessage Error:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * BRD Epic 3: Quick action button tap\r\n     * Endpoint: POST /api/chatbot/quick-action\r\n     */\r\n    async sendQuickAction(\r\n        conversationId: string,\r\n        bookingId: string,\r\n        userId: string,\r\n        action: string\r\n    ): Promise<ChatResponse> {\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/api/chatbot/quick-action`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ conversationId, bookingId, userId, action }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`Quick Action API Error: ${response.status}`);\r\n            }\r\n\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('ChatService.sendQuickAction Error:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * BRD Epic 5: Escalate to driver/support\r\n     * Endpoint: POST /api/chatbot/escalate\r\n     */\r\n    async escalate(request: EscalationRequest): Promise<any> {\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/api/chatbot/escalate`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(request),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`Escalation API Error: ${response.status}`);\r\n            }\r\n\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('ChatService.escalate Error:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Close conversation\r\n     * Endpoint: POST /api/chatbot/close\r\n     */\r\n    async closeConversation(conversationId: string, reason?: string): Promise<any> {\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/api/chatbot/close`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ conversationId, reason }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`Close API Error: ${response.status}`);\r\n            }\r\n\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('ChatService.closeConversation Error:', error);\r\n            throw error;\r\n        }\r\n    }\r\n}\r\n\r\nexport default new ChatService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}